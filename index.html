<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>niche kangaroo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b0c10;
      color: #f5f5f5;
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
    }
    .container {
      display: flex;
      gap: 24px;
      padding: 24px;
      max-width: 1000px;
      width: 100%;
    }
    .avatar-pane, .items-pane {
      background: #151820;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .avatar-pane {
      flex: 0 0 360px;
      text-align: center;
      cursor: pointer;
    }
    .avatar-pane h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .avatar-gif {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #2a2e3a;
    }
    .hint {
      margin-top: 8px;
      font-size: 13px;
      color: #a0a4b8;
    }

    .items-pane {
      flex: 1;
      overflow-y: auto;
      max-height: 420px;
    }
    .items-pane h2 {
      margin-top: 0;
      font-size: 18px;
    }
    .item-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 6px;
      border-radius: 8px;
      transition: background 0.15s ease;
    }
    .item:hover {
      background: #1f2430;
    }
    .item img {
      width: 48px;
      height: 48px;
      border-radius: 6px;
      border: 1px solid #2a2e3a;
      object-fit: cover;
      background: #101318;
    }
    .item a {
      color: #e2e5ff;
      text-decoration: none;
      font-size: 14px;
    }
    .item a:hover {
      text-decoration: underline;
    }
    .item-type {
      font-size: 11px;
      color: #9da3c3;
    }
    .error {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 8px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .avatar-pane {
        flex: none;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="avatar-pane" id="avatarPane">
      <!-- Replace src with a pre-generated spinning GIF of user 9942268162 -->
      <img
        src="niche.webp"
        alt="Roblox Avatar"
        class="avatar-gif"
        id="avatarGif"
      >
      <div class="hint">
        Click the avatar to join the outfit game.
      </div>
      <div class="error" id="avatarError" style="display:none;"></div>
    </div>

    <div class="items-pane">
      <h2>Currently Worn Items</h2>
      <ul class="item-list" id="itemList"></ul>
      <div class="error" id="itemsError" style="display:none;"></div>
    </div>
  </div>

  <script>
    // Hard-coded target user
    const ROBLOX_USER_ID = 9942268162;
    // Your experience (game) link that youâ€™ll create in section 2
    const EXPERIENCE_UNIVERSE_ID = 1234567890; // REPLACE with your universeId
    const EXPERIENCE_PLACE_ID   = 1234567890;  // REPLACE with your placeId

    // Clicking the avatar sends user to your Roblox game
    document.getElementById("avatarPane").addEventListener("click", () => {
      // Standard place link
      window.location.href = `https://www.roblox.com/games/${EXPERIENCE_PLACE_ID}`;
    });

    const itemListEl  = document.getElementById("itemList");
    const itemsError  = document.getElementById("itemsError");

    // Fetch humanoid description (worn items) from Roblox web API.
    // This ENDPOINT may require you to proxy it from your own backend depending on CORS;
    // structure is based on public Developer Forum docs for avatar APIs.[web:17][web:20]
    async function fetchWornItems(userId) {
      try {
        // Get humanoid description, then extract asset & bundle IDs
        const descRes = await fetch(
          `https://avatar.roblox.com/v1/users/${userId}/avatar`
        );
        if (!descRes.ok) {
          throw new Error("Failed to fetch avatar description");
        }
        const descData = await descRes.json();

        const assetIds = [];
        const bundleIds = [];

        // Accessories, shirts, pants etc. live under these fields; exact shape is documented in avatar APIs.[web:17][web:20]
        const fields = [
          "assets",           // accessories, emotes, etc.
          "equippedGear",
          "equippedEmotes"
        ];

        fields.forEach(field => {
          if (Array.isArray(descData[field])) {
            descData[field].forEach(item => {
              if (item.id && !assetIds.includes(item.id)) {
                assetIds.push(item.id);
              }
            });
          }
        });

        if (Array.isArray(descData["bodyColors"])) {
          // optional, not normally linked as items
        }

        if (Array.isArray(descData["outfits"])) {
          descData["outfits"].forEach(o => {
            if (o.id && !bundleIds.includes(o.id)) {
              bundleIds.push(o.id);
            }
          });
        }

        return { assetIds, bundleIds };
      } catch (err) {
        console.error(err);
        throw err;
      }
    }

    // Given a list of assetIds, get catalog data & thumbnails using catalog/thumbnail APIs.[web:11][web:15]
    async function fetchItemDetails(assetIds) {
      if (!assetIds.length) return [];

      // Chunk into batches of up to 50 ids to avoid URL length issues
      const chunks = [];
      const size = 50;
      for (let i = 0; i < assetIds.length; i += size) {
        chunks.push(assetIds.slice(i, i + size));
      }

      const results = [];

      for (const chunk of chunks) {
        const idsParam = chunk.join(",");
        const detailsRes = await fetch(
          `https://catalog.roblox.com/v1/assets?assetIds=${idsParam}`
        );
        if (!detailsRes.ok) continue;
        const detailsData = await detailsRes.json();
        // Expected shape: { data: [ { id, name, product, assetType, ... } ] }
        if (Array.isArray(detailsData.data)) {
          for (const item of detailsData.data) {
            results.push({
              id: item.id,
              name: item.name,
              type: item.assetType ? item.assetType.name || item.assetType : "Item"
            });
          }
        }
      }

      // Now get thumbnails in one call
      if (results.length) {
        const thumbIds = results.map(r => r.id).join(",");
        const thumbsRes = await fetch(
          `https://thumbnails.roblox.com/v1/assets?assetIds=${thumbIds}` +
          `&size=150x150&format=Png&isCircular=false`
        );
        if (thumbsRes.ok) {
          const thumbsData = await thumbsRes.json();
          const thumbMap = {};
          if (Array.isArray(thumbsData.data)) {
            thumbsData.data.forEach(t => {
              thumbMap[t.targetId] = t.imageUrl;
            });
          }
          results.forEach(r => {
            r.thumbnail = thumbMap[r.id] || "";
          });
        }
      }

      return results;
    }

    function renderItems(items) {
      itemListEl.innerHTML = "";
      if (!items.length) {
        itemListEl.innerHTML = "<li>No wearable items detected.</li>";
        return;
      }

      for (const item of items) {
        const li = document.createElement("li");
        li.className = "item";

        const img = document.createElement("img");
        img.src = item.thumbnail || "https://tr.rbxcdn.com/empty-150x150.png";
        img.alt = item.name;

        const textWrap = document.createElement("div");
        const link = document.createElement("a");
        link.href = `https://www.roblox.com/catalog/${item.id}`;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = item.name;

        const typeSpan = document.createElement("div");
        typeSpan.className = "item-type";
        typeSpan.textContent = item.type;

        textWrap.appendChild(link);
        textWrap.appendChild(typeSpan);

        li.appendChild(img);
        li.appendChild(textWrap);

        itemListEl.appendChild(li);
      }
    }

    (async () => {
      try {
        const { assetIds } = await fetchWornItems(ROBLOX_USER_ID);
        const details = await fetchItemDetails(assetIds);
        renderItems(details);
      } catch (err) {
        itemsError.style.display = "block";
        itemsError.textContent = "Failed to load worn items.";
      }
    })();
  </script>
</body>
</html>
